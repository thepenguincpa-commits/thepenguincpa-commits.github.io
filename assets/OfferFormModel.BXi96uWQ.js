import{F as H,r as A,S as K,e as S,m as D,k as G,f as q,am as X,an as Y}from"./index.CJpzWARr.js";import{I as Z}from"./AntdIcon.BEv94oZ9.js";import{d as k,e as ee}from"./OfferPayoutRepository.DMRgHBdS.js";import{U as te,u as re}from"./usersApi.CVFrqcan.js";import{C as P}from"./CheckboxControl.RiOjMMmV.js";import{F as ie,V as I,c as R,I as se,a as ae,r as ne}from"./validators.puhu6pph.js";import{S as y}from"./SelectControl.BdHLXDxG.js";var b={},Q;function oe(){if(Q)return b;Q=1,Object.defineProperty(b,"__esModule",{value:!0});var t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};return b.default=t,b}var le=oe();const ue=H(le);function T(){return T=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},T.apply(this,arguments)}const ce=(t,e)=>A.createElement(Z,T({},t,{ref:e,icon:ue})),Se=A.forwardRef(ce);class fe extends K{constructor(e){super(e.queryClient,{queryKey:["advertisers"],queryFn:async()=>re.getUsers({offset:0,limit:1e3,role:"advertiser"}),transform:(r={items:[],total:0,offset:0,limit:0})=>{const i=e.repositories.get(te);return{items:r.items.map(o=>i.get(o.id).updateFromJson(o)),repository:i}},staleTime:1e3*60*5,refetchOnWindowFocus:!0})}get repository(){return this.data.repository}get items(){return this.data.items}}function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function j(t,e,r){he(t,e),e.set(t,r)}function he(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(t,e){var r=$(t,e,"get");return de(t,r)}function de(t,e){return e.get?e.get.call(t):e.value}function M(t,e,r){var i=$(t,e,"set");return pe(t,i,r),r}function $(t,e,r){if(!e.has(t))throw new TypeError("attempted to "+r+" private field on non-instance");return e.get(t)}function pe(t,e,r){if(e.set)e.set.call(t,r);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=r}}var me=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",a=new WeakMap,g=new WeakMap;class E{constructor(e){var{executor:r=()=>{},internals:i=F(),promise:o=new Promise((l,d)=>r(l,d,v=>{i.onCancelList.push(v)}))}=e;j(this,a,{writable:!0,value:void 0}),j(this,g,{writable:!0,value:void 0}),h(this,me,"CancelablePromise"),this.cancel=this.cancel.bind(this),M(this,a,i),M(this,g,o||new Promise((l,d)=>r(l,d,v=>{i.onCancelList.push(v)})))}then(e,r){return C(s(this,g).then(O(e,s(this,a)),O(r,s(this,a))),s(this,a))}catch(e){return C(s(this,g).catch(O(e,s(this,a))),s(this,a))}finally(e,r){return r&&s(this,a).onCancelList.push(e),C(s(this,g).finally(O(()=>{if(e)return r&&(s(this,a).onCancelList=s(this,a).onCancelList.filter(i=>i!==e)),e()},s(this,a))),s(this,a))}cancel(){s(this,a).isCanceled=!0;var e=s(this,a).onCancelList;s(this,a).onCancelList=[];for(var r of e)if(typeof r=="function")try{r()}catch(i){console.error(i)}}isCanceled(){return s(this,a).isCanceled===!0}}class f extends E{constructor(e){super({executor:e})}}h(f,"all",function(e){return L(e,Promise.all(e))});h(f,"allSettled",function(e){return L(e,Promise.allSettled(e))});h(f,"any",function(e){return L(e,Promise.any(e))});h(f,"race",function(e){return L(e,Promise.race(e))});h(f,"resolve",function(e){return z(Promise.resolve(e))});h(f,"reject",function(e){return z(Promise.reject(e))});h(f,"isCancelable",x);function z(t){return C(t,F())}function x(t){return t instanceof f||t instanceof E}function O(t,e){if(t)return r=>{if(!e.isCanceled){var i=t(r);return x(i)&&e.onCancelList.push(i.cancel),i}return r}}function C(t,e){return new E({internals:e,promise:t})}function L(t,e){var r=F();return r.onCancelList.push(()=>{for(var i of t)x(i)&&i.cancel()}),new E({internals:r,promise:e})}function F(){return{isCanceled:!1,onCancelList:[]}}var ve=Object.defineProperty,ge=(t,e,r)=>e in t?ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e,r)=>ge(t,typeof e!="symbol"?e+"":e,r);function we(t){return t.isTouched&&t.isDirty&&t.errorMessage?{help:t.errorMessage,validateStatus:"error"}:{}}class Pe extends ie{constructor(e,{ref:r,onChange:i,onBlur:o,onFocus:l,initialPreviewGetter:d,validators:v,props:J,...U}={}){super(e,{validators:v?.map(u=>()=>u(this)),...U}),m(this,"actions"),m(this,"props"),m(this,"initialPreviewGetter"),m(this,"isLoading",!1),m(this,"error",null),m(this,"preview",null),this.props=S(()=>J?.()),this.initialPreviewGetter=d||(()=>""),this.setPreview(this.initialPreviewGetter());let _=null;this.actions={ref:u=>{this.element=u?.nativeElement||null,r&&r(u)},onChange:u=>{const w=u?.fileList[0].originFileObj||null;this.setValue(w),_!==null&&_.cancel();const V=Symbol("newValue");w===null?this.setPreview(null):_=new f((c,N,W)=>{this.setIsLoading(!0);const p=new FileReader;p.readAsDataURL(w),p.onload=()=>{c(p.result)},p.onerror=B=>{N(B)},p.onabort=()=>{c(V)},W(()=>{p.abort()})}).then(c=>{c!==V&&(this.setPreview(c),this.setError(null),this.setIsLoading(!1))}).catch(c=>{this.setPreview(null),this.setError(c instanceof Error?c:new Error(String(c))),this.setIsLoading(!1)}),i&&i(w)},onBlur:u=>{this.setTouched(!0),this.setFocused(!1),o&&o(u)},onFocus:u=>{this.setFocused(!0),l&&l(u)}},D(this,{error:q.ref,preview:q,itemProps:S,setPreview:G.bound,isLoading:q,setIsLoading:G})}setIsLoading(e){this.isLoading=e}get itemProps(){return we(this)}setError(e){this.error=e}setPreview(e){this.preview=e}reset(){return super.reset(),this.setPreview(this.initialPreviewGetter()),this}get inputProps(){return{...this.props.get(),...this.actions,value:this.value,preview:this.preview,initialPreview:this.initialPreviewGetter()}}}var ye=Object.defineProperty,be=(t,e,r)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,n=(t,e,r)=>be(t,typeof e!="symbol"?e+"":e,r);class Te{constructor(e,r){this.appContext=e,this.offerGetter=r,n(this,"categoriesQuery"),n(this,"advertisersQuery"),n(this,"requiredValidator",ne(()=>this.t.forms("required"))),n(this,"advertiserId",new y(()=>this.offer.vertical,{options:()=>this.advertisersQuery.items.map(i=>({value:i.id,label:i.name})),validators:[this.requiredValidator]})),n(this,"image",new Pe(()=>null,{validators:[i=>i.value===null&&!this.offer.image?[{type:I.Error,message:this.t.forms("required")}]:[],i=>{const o=i.value;return o===null?[]:o.size/1024/1024<5?o.type==="image/jpeg"||o.type==="image/png"?[]:[{type:I.Error,message:"Поддерживаются только JPG/PNG файлы!"}]:[{type:I.Error,message:"Изображение не должно превышать 5 МБ!"}]}]})),n(this,"title",new R(()=>this.offer.title,{validators:[this.requiredValidator]})),n(this,"subtitle",new R(()=>this.offer.subtitle,{validators:[this.requiredValidator]})),n(this,"vertical",new y(()=>this.offer.vertical,{options:()=>Object.values(X).map(i=>({value:i,label:this.t.offer(`vertical.${i}`)})),validators:[this.requiredValidator]})),n(this,"category",new y(()=>this.offer.categoryId,{options:()=>{let i=!1;const o=this.categoriesQuery.items.map(l=>(l.id===this.offer.categoryId&&(i=!0),{value:l.id,label:this.appContext.locale.code==="en"?l.nameEn:l.nameRu}));return i||o.unshift({label:"Категория",value:this.offer.categoryId}),o},props:()=>({loading:this.categoriesQuery.isPending}),validators:[this.requiredValidator]})),n(this,"status",new y(()=>this.offer.status,{options:()=>Object.values(Y).map(i=>({value:i,label:this.t.offer(`status.${i}`)})),validators:[this.requiredValidator]})),n(this,"rules",new se(()=>this.offer.rules,{validators:[this.requiredValidator]})),n(this,"accessOnRequest",new P(()=>this.offer.accessOnRequest,{validators:[this.requiredValidator]})),n(this,"isTest",new P(()=>this.offer.isTest,{validators:[this.requiredValidator]})),n(this,"isExclusive",new P(()=>this.offer.isExclusive,{validators:[this.requiredValidator]})),n(this,"isTopOffer",new P(()=>this.offer.isTopOffer,{validators:[this.requiredValidator]})),n(this,"group",new ae({image:this.image,title:this.title,subtitle:this.subtitle,advertiserId:this.advertiserId,vertical:this.vertical,category:this.category,status:this.status,isTest:this.isTest,isExclusive:this.isExclusive,isTopOffer:this.isTopOffer,rules:this.rules,accessOnRequest:this.accessOnRequest})),this.categoriesQuery=new k(e),this.advertisersQuery=new fe(e),D(this,{offer:S},{autoBind:!0})}get offer(){return this.offerGetter()||new ee("")}get t(){return this.appContext.locale.translations}}export{Pe as I,Te as O,Se as R};
