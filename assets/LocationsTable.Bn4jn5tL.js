import{z as u,w as b,x as p,y as h,n as _,Q as x,o as P,r as g,j as o,c as j}from"./index.B-zO2jcy.js";import{c as F,b as w,a as O,O as C,o as v,C as R}from"./CountryName.BQMzn-nx.js";import{O as J,B as N}from"./Box.MGoU-yNc.js";import{r as m,F as E}from"./renderReactiveCell.HbM7Emo9.js";import{F as M,C as f}from"./FlagIcon.Ds-_yvnp.js";import{N as T}from"./NumberFormat.CuYZvbUu.js";import{T as q}from"./AntdIcon.BzrxpPa1.js";var D=Object.defineProperty,L=(n,e,r)=>e in n?D(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,c=(n,e,r)=>L(n,typeof e!="symbol"?e+"":e,r);class Q{constructor(e,r,s){this.categoriesQuery=r,this.offerId=s,c(this,"offer"),c(this,"repositories"),c(this,"locations",u.array()),c(this,"basePayouts",u.array()),c(this,"personalPayouts",u.array()),c(this,"domains",u.array()),this.repositories={offer:e.repositories.get(C),location:e.repositories.get(O),basePayout:e.repositories.get(w),personalPayout:e.repositories.get(F),domain:e.repositories.get(J)},this.offer=this.repositories.offer.get(s),b(this,{category:p,landings:p({equals:h.shallow}),transits:p({equals:h.shallow}),updateFromJson:_})}get category(){return this.categoriesQuery.repository.get(this.offer.category)}get landings(){return this.domains.filter(e=>e.type==="landing")}get transits(){return this.domains.filter(e=>e.type==="transit")}updateFromJson({locations:e,basePayouts:r,personalPayouts:s,domains:i,...l}){this.offer.updateFromJson({...l,locations:e.map(t=>t.id),basePayouts:r.map(t=>t.id),personalPayouts:s.map(t=>t.id),domains:i.map(t=>t.id)}),this.locations.replace(e.map(t=>this.repositories.location.get(t.id).updateFromJson(t))),this.basePayouts.replace(r.map(t=>this.repositories.basePayout.get(t.id).updateFromJson(t))),this.personalPayouts.replace(s.map(t=>this.repositories.personalPayout.get(t.id).updateFromJson(t))),this.domains.replace(i.map(t=>this.repositories.domain.get(t.id).updateFromJson(t)))}}class Y extends x{constructor(e,r,s,i){const l=new Q(e,r,s);super(e.queryClient,{queryKey:["offer",s,i],queryFn:()=>v.getOffersId({offerId:s,campaign:i}),onError:t=>{e.notify.toastError(t)},transform:t=>(t&&l.updateFromJson(t),l),staleTime:1e3*60*5}),this.categoriesQuery=r,this.offerId=s,this.campaignId=i,b({locationsWithPayouts:p})}get store(){return this.data}get locationsWithPayouts(){const e=this.store.basePayouts,r=this.store.personalPayouts;return this.store.locations.map(s=>{const i=e.find(t=>t.location===s.id)||e[0],l=r.find(t=>t.location===s.id);return{id:s.id,location:s,basePayout:i,payout:l}})}updateFromJson(e){this.setQueryData(e,{updatedAt:Date.now()})}}const S="_card_17bcj_1",W="_card_body_17bcj_5",A="_table_17bcj_9",B="_payoutModified_17bcj_50",I="_payoutCell_17bcj_56",K="_priceCell_17bcj_60",d={card:S,card_body:W,table:A,payoutModified:B,payoutCell:I,priceCell:K},$={y:512},Z=P(function({offerQuery:e,size:r,scroll:s=$}){const i=g.useMemo(()=>[{title:"Страна",dataIndex:"country",key:"country",render:m(({location:a})=>o.jsxs(N,{nowrap:!0,align:"center",gap:"xs",children:[o.jsx(M,{code:a.countryCode}),o.jsx(R,{code:a.countryCode})]}))},{title:"Выпл. $",dataIndex:"payout",key:"payout",render:m(({payout:a,basePayout:y})=>a?o.jsx(q,{overlay:`Специальные условия: ${o.jsx(T,{signDisplay:"always",value:a.amount-y.amount})}`,children:o.jsx("div",{className:j(d.payoutCell,d.payoutModified),children:o.jsx(f,{code:a.currency,value:a.amount})})}):o.jsx("div",{className:d.payoutCell,children:o.jsx(f,{code:y.currency,value:y.amount})})),width:96},{title:"На сайте",dataIndex:"sitePrice",key:"sitePrice",render:m(({location:a})=>o.jsx("div",{className:d.priceCell,children:o.jsx(f,{code:a.currency,value:a.price})})),width:108}],[]),l=e.locationsWithPayouts,t=g.useMemo(()=>({defaultExpandAllRows:!0,expandedRowRender:a=>o.jsx(o.Fragment,{children:o.jsx("p",{style:{margin:0},children:a.location.locationRestrictions})}),showExpandColumn:!1}),[]);return o.jsx(E,{rowKey:"id",size:r,columns:i,pagination:!1,dataSource:l,className:d.table,scroll:s||void 0,loading:!e.isFetched&&e.isFetching,expandable:t})});export{Z as L,Y as O,d as s};
