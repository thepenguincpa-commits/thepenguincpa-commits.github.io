var ot=i=>{throw TypeError(i)};var V=(i,t,s)=>t.has(i)||ot("Cannot "+s);var e=(i,t,s)=>(V(i,t,"read from private field"),s?s.call(i):t.get(i)),l=(i,t,s)=>t.has(i)?ot("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,s),h=(i,t,s,n)=>(V(i,t,"write to private field"),n?n.call(i,s):t.set(i,s),s),o=(i,t,s)=>(V(i,t,"access private method"),s);import{aY as Rt,aZ as lt,a_ as R,a$ as K,b0 as P,b1 as mt,b2 as ct,b3 as ut,b4 as gt,b5 as Ot,b6 as yt,b7 as dt,aa as St}from"./index.4zeDQRVO.js";var p,r,x,u,C,U,g,O,L,w,F,I,T,y,D,a,E,N,Y,Z,$,G,J,X,vt,bt,wt=(bt=class extends Rt{constructor(t,s){super();l(this,a);l(this,p);l(this,r);l(this,x);l(this,u);l(this,C);l(this,U);l(this,g);l(this,O);l(this,L);l(this,w);l(this,F);l(this,I);l(this,T);l(this,y);l(this,D,new Set);this.options=s,h(this,p,t),h(this,O,null),h(this,g,lt()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(e(this,r).addObserver(this),ft(e(this,r),this.options)?o(this,a,E).call(this):this.updateResult(),o(this,a,$).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return q(e(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return q(e(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,o(this,a,G).call(this),o(this,a,J).call(this),e(this,r).removeObserver(this)}setOptions(t){const s=this.options,n=e(this,r);if(this.options=e(this,p).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof R(this.options.enabled,e(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");o(this,a,X).call(this),e(this,r).setOptions(this.options),s._defaulted&&!K(this.options,s)&&e(this,p).getQueryCache().notify({type:"observerOptionsUpdated",query:e(this,r),observer:this});const d=this.hasListeners();d&&pt(e(this,r),n,this.options,s)&&o(this,a,E).call(this),this.updateResult(),d&&(e(this,r)!==n||R(this.options.enabled,e(this,r))!==R(s.enabled,e(this,r))||P(this.options.staleTime,e(this,r))!==P(s.staleTime,e(this,r)))&&o(this,a,N).call(this);const b=o(this,a,Y).call(this);d&&(e(this,r)!==n||R(this.options.enabled,e(this,r))!==R(s.enabled,e(this,r))||b!==e(this,y))&&o(this,a,Z).call(this,b)}getOptimisticResult(t){const s=e(this,p).getQueryCache().build(e(this,p),t),n=this.createResult(s,t);return It(this,n)&&(h(this,u,n),h(this,U,this.options),h(this,C,e(this,r).state)),n}getCurrentResult(){return e(this,u)}trackResult(t,s){return new Proxy(t,{get:(n,d)=>(this.trackProp(d),s?.(d),d==="promise"&&!this.options.experimental_prefetchInRender&&e(this,g).status==="pending"&&e(this,g).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(n,d))})}trackProp(t){e(this,D).add(t)}getCurrentQuery(){return e(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=e(this,p).defaultQueryOptions(t),n=e(this,p).getQueryCache().build(e(this,p),s);return n.fetch().then(()=>this.createResult(n,s))}fetch(t){return o(this,a,E).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),e(this,u)))}createResult(t,s){const n=e(this,r),d=this.options,b=e(this,u),M=e(this,C),j=e(this,U),z=t!==n?t.state:e(this,x),{state:et}=t;let c={...et},st=!1,f;if(s._optimisticResults){const v=this.hasListeners(),_=!v&&ft(t,s),Q=v&&pt(t,n,s,d);(_||Q)&&(c={...c,...yt(et.data,t.options)}),s._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:it,errorUpdatedAt:rt,status:S}=c;f=c.data;let at=!1;if(s.placeholderData!==void 0&&f===void 0&&S==="pending"){let v;b?.isPlaceholderData&&s.placeholderData===j?.placeholderData?(v=b.data,at=!0):v=typeof s.placeholderData=="function"?s.placeholderData(e(this,F)?.state.data,e(this,F)):s.placeholderData,v!==void 0&&(S="success",f=dt(b?.data,v,s),st=!0)}if(s.select&&f!==void 0&&!at)if(b&&f===M?.data&&s.select===e(this,L))f=e(this,w);else try{h(this,L,s.select),f=s.select(f),f=dt(b?.data,f,s),h(this,w,f),h(this,O,null)}catch(v){h(this,O,v)}e(this,O)&&(it=e(this,O),f=e(this,w),rt=Date.now(),S="error");const W=c.fetchStatus==="fetching",B=S==="pending",H=S==="error",nt=B&&W,ht=f!==void 0,m={status:S,fetchStatus:c.fetchStatus,isPending:B,isSuccess:S==="success",isError:H,isInitialLoading:nt,isLoading:nt,data:f,dataUpdatedAt:c.dataUpdatedAt,error:it,errorUpdatedAt:rt,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>z.dataUpdateCount||c.errorUpdateCount>z.errorUpdateCount,isFetching:W,isRefetching:W&&!B,isLoadingError:H&&!ht,isPaused:c.fetchStatus==="paused",isPlaceholderData:st,isRefetchError:H&&ht,isStale:tt(t,s),refetch:this.refetch,promise:e(this,g),isEnabled:R(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const v=A=>{m.status==="error"?A.reject(m.error):m.data!==void 0&&A.resolve(m.data)},_=()=>{const A=h(this,g,m.promise=lt());v(A)},Q=e(this,g);switch(Q.status){case"pending":t.queryHash===n.queryHash&&v(Q);break;case"fulfilled":(m.status==="error"||m.data!==Q.value)&&_();break;case"rejected":(m.status!=="error"||m.error!==Q.reason)&&_();break}}return m}updateResult(){const t=e(this,u),s=this.createResult(e(this,r),this.options);if(h(this,C,e(this,r).state),h(this,U,this.options),e(this,C).data!==void 0&&h(this,F,e(this,r)),K(s,t))return;h(this,u,s);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:d}=this.options,b=typeof d=="function"?d():d;if(b==="all"||!b&&!e(this,D).size)return!0;const M=new Set(b??e(this,D));return this.options.throwOnError&&M.add("error"),Object.keys(e(this,u)).some(j=>{const k=j;return e(this,u)[k]!==t[k]&&M.has(k)})};o(this,a,vt).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&o(this,a,$).call(this)}},p=new WeakMap,r=new WeakMap,x=new WeakMap,u=new WeakMap,C=new WeakMap,U=new WeakMap,g=new WeakMap,O=new WeakMap,L=new WeakMap,w=new WeakMap,F=new WeakMap,I=new WeakMap,T=new WeakMap,y=new WeakMap,D=new WeakMap,a=new WeakSet,E=function(t){o(this,a,X).call(this);let s=e(this,r).fetch(this.options,t);return t?.throwOnError||(s=s.catch(mt)),s},N=function(){o(this,a,G).call(this);const t=P(this.options.staleTime,e(this,r));if(ct||e(this,u).isStale||!ut(t))return;const n=gt(e(this,u).dataUpdatedAt,t)+1;h(this,I,setTimeout(()=>{e(this,u).isStale||this.updateResult()},n))},Y=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(e(this,r)):this.options.refetchInterval)??!1},Z=function(t){o(this,a,J).call(this),h(this,y,t),!(ct||R(this.options.enabled,e(this,r))===!1||!ut(e(this,y))||e(this,y)===0)&&h(this,T,setInterval(()=>{(this.options.refetchIntervalInBackground||Ot.isFocused())&&o(this,a,E).call(this)},e(this,y)))},$=function(){o(this,a,N).call(this),o(this,a,Z).call(this,o(this,a,Y).call(this))},G=function(){e(this,I)&&(clearTimeout(e(this,I)),h(this,I,void 0))},J=function(){e(this,T)&&(clearInterval(e(this,T)),h(this,T,void 0))},X=function(){const t=e(this,p).getQueryCache().build(e(this,p),this.options);if(t===e(this,r))return;const s=e(this,r);h(this,r,t),h(this,x,t.state),this.hasListeners()&&(s?.removeObserver(this),t.addObserver(this))},vt=function(t){St.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(e(this,u))}),e(this,p).getQueryCache().notify({query:e(this,r),type:"observerResultsUpdated"})})},bt);function Ct(i,t){return R(t.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&t.retryOnMount===!1)}function ft(i,t){return Ct(i,t)||i.state.data!==void 0&&q(i,t,t.refetchOnMount)}function q(i,t,s){if(R(t.enabled,i)!==!1&&P(t.staleTime,i)!=="static"){const n=typeof s=="function"?s(i):s;return n==="always"||n!==!1&&tt(i,t)}return!1}function pt(i,t,s,n){return(i!==t||R(n.enabled,i)===!1)&&(!s.suspense||i.state.status!=="error")&&tt(i,s)}function tt(i,t){return R(t.enabled,i)!==!1&&i.isStaleByTime(P(t.staleTime,i))}function It(i,t){return!K(i.getCurrentResult(),t)}export{wt as Q};
