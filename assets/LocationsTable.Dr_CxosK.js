import{f as u,m as g,e as p,P as h,k as P,S as x,o as j,r as b,j as o,s as F}from"./index.CJpzWARr.js";import{O as w,a as O,b as v,c as R}from"./OfferPayoutRepository.DMRgHBdS.js";import{w as C}from"./webmasterOffersApi.CMJMZz74.js";import{O as J}from"./OfferDomainRepository.C35Cl61S.js";import{u as N}from"./useTranslation.D1-YSIqG.js";import{r as y}from"./renderReactiveCell.D7yC0G9H.js";import{B as T}from"./Box.CvVauy6S.js";import{C as E}from"./CountryName.Cqd_TUYv.js";import{C as f}from"./Currency.Cy3QZbvy.js";import{F as M}from"./FlagIcon.DC8lzl7_.js";import{N as q}from"./NumberFormat.TovQIcex.js";import{T as D}from"./AntdIcon.BEv94oZ9.js";import{F as I}from"./Table.CnZn0sov.js";var S=Object.defineProperty,L=(n,e,s)=>e in n?S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,l=(n,e,s)=>L(n,typeof e!="symbol"?e+"":e,s);class W{constructor(e,s,r){this.categoriesQuery=s,this.offerId=r,l(this,"offer"),l(this,"repositories"),l(this,"locations",u.array()),l(this,"basePayouts",u.array()),l(this,"personalPayouts",u.array()),l(this,"domains",u.array()),this.repositories={offer:e.repositories.get(R),location:e.repositories.get(v),basePayout:e.repositories.get(O),personalPayout:e.repositories.get(w),domain:e.repositories.get(J)},this.offer=this.repositories.offer.get(r),g(this,{category:p,landings:p({equals:h.shallow}),transits:p({equals:h.shallow}),updateFromJson:P})}get category(){return this.categoriesQuery.repository.get(this.offer.categoryId)}get landings(){return this.domains.filter(e=>e.type==="landing")}get transits(){return this.domains.filter(e=>e.type==="transit")}updateFromJson({locations:e,basePayouts:s,personalPayouts:r,domains:a,...c}){this.offer.updateFromJson({...c,locations:e.map(t=>t.id),basePayouts:s.map(t=>t.id),personalPayouts:r.map(t=>t.id),domains:a.map(t=>t.id)}),this.locations.replace(e.map(t=>this.repositories.location.get(t.id).updateFromJson(t))),this.basePayouts.replace(s.map(t=>this.repositories.basePayout.get(t.id).updateFromJson(t))),this.personalPayouts.replace(r.map(t=>this.repositories.personalPayout.get(t.id).updateFromJson(t))),this.domains.replace(a.map(t=>this.repositories.domain.get(t.id).updateFromJson(t)))}}class ie extends x{constructor(e,s,r,a){const c=new W(e,s,r);super(e.queryClient,{queryKey:["offer",r,a],queryFn:()=>C.getOffersId({offerId:r,campaign:a}),onError:t=>{e.notify.toastError(t)},transform:t=>(t&&c.updateFromJson(t),c),staleTime:1e3*60*5}),this.categoriesQuery=s,this.offerId=r,this.campaignId=a,g({locationsWithPayouts:p})}get store(){return this.data}get locationsWithPayouts(){const e=this.store.basePayouts,s=this.store.personalPayouts;return this.store.locations.map(r=>{const a=e.find(t=>t.locationId===r.id)||e[0],c=s.find(t=>t.locationId===r.id);return{id:r.id,location:r,basePayout:a,payout:c}})}updateFromJson(e){this.setQueryData(e,{updatedAt:Date.now()})}}const A="_card_17bcj_1",B="_card_body_17bcj_5",Q="_table_17bcj_9",K="_payoutModified_17bcj_50",k="_payoutCell_17bcj_56",z="_priceCell_17bcj_60",d={card:A,card_body:B,table:Q,payoutModified:K,payoutCell:k,priceCell:z},G={y:512},ne=j(function({offerQuery:e,size:s,scroll:r=G}){const{t:a}=N("offer"),c=b.useMemo(()=>[{title:a("card.country"),dataIndex:"country",key:"country",render:y(({location:i})=>o.jsxs(T,{nowrap:!0,align:"center",gap:"xs",children:[o.jsx(M,{code:i.country}),o.jsx(E,{code:i.country})]}))},{title:a("card.payout"),dataIndex:"payout",key:"payout",render:y(({payout:i,basePayout:m})=>i?o.jsx(D,{overlay:a("card.personalPayoutTooltip",{diff:o.jsx(q,{signDisplay:"always",value:i.amount-m.amount})}),children:o.jsx("div",{className:F(d.payoutCell,d.payoutModified),children:o.jsx(f,{code:i.currency,value:i.amount})})}):o.jsx("div",{className:d.payoutCell,children:o.jsx(f,{code:m.currency,value:m.amount})})),width:96},{title:a("card.sitePrice"),dataIndex:"sitePrice",key:"sitePrice",render:y(({location:i})=>o.jsx("div",{className:d.priceCell,children:o.jsx(f,{code:i.currency,value:i.price})})),width:108}],[a]),t=e.locationsWithPayouts,_=b.useMemo(()=>({defaultExpandAllRows:!0,expandedRowRender:i=>o.jsx(o.Fragment,{children:o.jsx("p",{style:{margin:0},children:i.location.locationRestrictions})}),showExpandColumn:!1}),[]);return o.jsx(I,{rowKey:"id",size:s,columns:c,pagination:!1,dataSource:t,className:d.table,scroll:r||void 0,loading:!e.isFetched&&e.isFetching,expandable:_})});export{ne as L,ie as O,d as s};
