import{F as T,r as d,l as B,_ as K,B as z,J as D,y as _,a7 as N,t as E,a0 as Q,o as P,j as c,aT as C,u as G,a1 as J}from"./index.CJpzWARr.js";import{L as W}from"./LayoutContainer.kUniMi3O.js";import{U as V}from"./usersApi.CVFrqcan.js";import{I as H}from"./InfiniteQueryWithState.DU3fxF3Q.js";import{r as p}from"./renderReactiveCell.D7yC0G9H.js";import{u as R}from"./useTranslation.DVdJGqhZ.js";import{I as L,T as X}from"./AntdIcon.BEv94oZ9.js";import{R as Y,a as Z}from"./ClockCircleOutlined.CyJe1gJd.js";import{T as k}from"./index.mfBRClzR.js";import{F as ee}from"./Table.CnZn0sov.js";import{P as te}from"./index.C7EzEdlH.js";import{F as re}from"./index.D5519FJg.js";import{P as q}from"./index.Dr9pHSB9.js";import{B as A}from"./button.CTAkPJpI.js";import{C as ne}from"./Input.BJc5rBil.js";import{R as oe}from"./SyncOutlined.DPlxgDWy.js";import"./useClosable.Emosx8Km.js";import"./index.B7lSVg36.js";import"./index.5jmBMbM4.js";import"./ActionButton.D2hXE_0n.js";var h={},M;function se(){if(M)return h;M=1,Object.defineProperty(h,"__esModule",{value:!0});var n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};return h.default=n,h}var ae=se();const ie=T(ae);function x(){return x=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},x.apply(this,arguments)}const ce=(n,e)=>d.createElement(L,x({},n,{ref:e,icon:ie})),le=d.forwardRef(ce);var m={},S;function ue(){if(S)return m;S=1,Object.defineProperty(m,"__esModule",{value:!0});var n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"}}]},name:"close",theme:"outlined"};return m.default=n,m}var fe=ue();const pe=T(fe);function j(){return j=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},j.apply(this,arguments)}const de=(n,e)=>d.createElement(L,j({},n,{ref:e,icon:pe})),he=d.forwardRef(de);B(()=>K(()=>Promise.resolve().then(()=>Le),void 0).then(n=>({default:n.ManagerModerationPage})));function me(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function U(n,e,r,t,s,a,o){try{var l=n[a](o),u=l.value}catch(i){r(i);return}l.done?e(u):Promise.resolve(u).then(t,s)}function g(n){return function(){var e=this,r=arguments;return new Promise(function(t,s){var a=n.apply(e,r);function o(u){U(a,t,s,o,l,"next",u)}function l(u){U(a,t,s,o,l,"throw",u)}o(void 0)})}}function ge(n,e,r){return e=v(e),we(n,F()?Reflect.construct(e,r||[],v(n).constructor):e.apply(n,r))}function ye(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function be(n,e,r){return e&&ve(n.prototype,e),n}function v(n){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},v(n)}function _e(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&O(n,e)}function we(n,e){return e&&(Ae(e)==="object"||typeof e=="function")?e:me(n)}function O(n,e){return O=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t},O(n,e)}function Ae(n){"@swc/helpers - typeof";return n&&typeof Symbol<"u"&&n.constructor===Symbol?"symbol":typeof n}function F(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(F=function(){return!!n})()}function y(n,e){var r,t,s,a={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=l(0),o.throw=l(1),o.return=l(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(i){return function(f){return u([i,f])}}function u(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(a=0)),a;)try{if(r=1,t&&(s=i[0]&2?t.return:i[0]?t.throw||((s=t.return)&&s.call(t),0):t.next)&&!(s=s.call(t,i[1])).done)return s;switch(t=0,s&&(i=[i[0]&2,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,t=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(i[0]===6||i[0]===2)){a=0;continue}if(i[0]===3&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(i[0]===6&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(n,a)}catch(f){i=[6,f],t=0}finally{r=s=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}var xe=(function(n){_e(e,n);function e(){return ye(this,e),ge(this,e,arguments)}return be(e,[{key:"getApprovalsAccountsRaw",value:function(t,s){return g(function(){var a,o,l,u,i;return y(this,function(f){switch(f.label){case 0:if(t.offset==null)throw new _("offset",'Required parameter "offset" was null or undefined when calling getApprovalsAccounts().');return a={},t.offset!=null&&(a.offset=t.offset),t.limit!=null&&(a.limit=t.limit),o={},this.configuration&&this.configuration.apiKey?(l="x-access-token",[4,this.configuration.apiKey("x-access-token")]):[3,2];case 1:o[l]=f.sent(),f.label=2;case 2:return u="/approvals/accounts",[4,this.request({path:u,method:"GET",headers:o,query:a},s)];case 3:return i=f.sent(),[2,new D(i)]}})}).call(this)}},{key:"getApprovalsAccounts",value:function(t,s){return g(function(){var a;return y(this,function(o){switch(o.label){case 0:return[4,this.getApprovalsAccountsRaw(t,s)];case 1:return a=o.sent(),[4,a.value()];case 2:return[2,o.sent()]}})}).call(this)}},{key:"postApprovalsAccountsUseridRaw",value:function(t,s){return g(function(){var a,o,l,u,i;return y(this,function(f){switch(f.label){case 0:if(t.userId==null)throw new _("userId",'Required parameter "userId" was null or undefined when calling postApprovalsAccountsUserid().');if(t.postApprovalsAccountsUseridRequest==null)throw new _("postApprovalsAccountsUseridRequest",'Required parameter "postApprovalsAccountsUseridRequest" was null or undefined when calling postApprovalsAccountsUserid().');return a={},o={},o["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey?(l="x-access-token",[4,this.configuration.apiKey("x-access-token")]):[3,2];case 1:o[l]=f.sent(),f.label=2;case 2:return u="/approvals/accounts/{userId}",u=u.replace("{userId}",encodeURIComponent(String(t.userId))),[4,this.request({path:u,method:"POST",headers:o,query:a,body:t.postApprovalsAccountsUseridRequest},s)];case 3:return i=f.sent(),[2,new N(i)]}})}).call(this)}},{key:"postApprovalsAccountsUserid",value:function(t,s){return g(function(){return y(this,function(a){switch(a.label){case 0:return[4,this.postApprovalsAccountsUseridRaw(t,s)];case 1:return a.sent(),[2]}})}).call(this)}}]),e})(z),I=new xe,je=Object.defineProperty,Oe=(n,e,r)=>e in n?je(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,w=(n,e,r)=>Oe(n,typeof e!="symbol"?e+"":e,r);class Pe{constructor(e){this.appContext=e,w(this,"query"),w(this,"limit",10),w(this,"offset",0),E(this,{},{autoBind:!0});const r=e.repositories.get(V);this.query=new H(e.queryClient,{queryKey:this.getQueryKey(),queryFn:async()=>I.getApprovalsAccounts({offset:0,limit:20}),getNextPageParam:(t,s)=>{const a=s.reduce((o,l)=>o+(l.items?.length||0),0);if(!(a>=t.total))return a},initialPageParam:0,transform:({pages:t}={pageParams:[],pages:[]})=>({data:t.flatMap(a=>(a.items||[]).map(o=>o.user?{id:o.user.id,data:r.get(o.user.id).updateFromJson(o.user),submittedAt:o.submittedAt,mutation:this.getUpdateMutation(o.user.id)}:null).filter(Boolean)),total:(t[t.length-1]||{total:0}).total}),onError:t=>{e.notify.toastError(t)},placeholderData:t=>t})}get data(){return this.query.data.data}get total(){return this.query.data.total}get currentPage(){return Math.floor(this.offset/this.limit)+1}refresh(){this.query.refetch()}getQueryKey(){return["manager-moderation-users",this.limit,this.offset]}handlePagination(e,r){this.limit=r,this.offset=(e-1)*r,this.query.updateOptions({queryKey:this.getQueryKey()})}getUpdateMutation(e){return new Q(this.appContext.queryClient,{mutationFn:async r=>I.postApprovalsAccountsUserid({userId:e,postApprovalsAccountsUseridRequest:r}),onSuccess:()=>{this.query.invalidate(),this.appContext.notify.toastSuccess({message:"Действие выполнено успешно"})},onError:r=>{this.appContext.notify.toastError(r)}})}}var Re=Object.defineProperty,Ce=(n,e,r)=>e in n?Re(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,ke=(n,e,r)=>Ce(n,e+"",r);class qe{constructor(e){ke(this,"usersList"),E(this,{},{autoBind:!0}),this.usersList=new Pe(e)}dispose(){}}const Me="_card_1k3hr_1",Se="_body_1k3hr_1",Ue="_table_1k3hr_4",Ie="_pagination_1k3hr_13",b={card:Me,body:Se,table:Ue,pagination:Ie},Te=P(function({mutation:e,data:r}){const{t}=R("users");return c.jsxs(re,{gap:"small",children:[c.jsx(q,{title:t("actions.activateConfirm"),description:t("actions.activateDescription",{name:r.name}),onConfirm:()=>e.mutateAsync({action:C.Approve}),okText:t("buttons.yes",{ns:"common"}),cancelText:t("buttons.cancel",{ns:"common"}),placement:"left",children:c.jsx(A,{type:"primary",icon:c.jsx(le,{}),loading:e.isPending})}),c.jsx(q,{title:t("actions.rejectConfirm"),description:t("actions.rejectDescription",{name:r.name}),onConfirm:()=>e.mutateAsync({action:C.Reject}),okText:t("buttons.yes",{ns:"common"}),cancelText:t("buttons.cancel",{ns:"common"}),placement:"left",children:c.jsx(A,{danger:!0,icon:c.jsx(he,{}),loading:e.isPending})})]})}),Ee=P(function({model:e}){const{t:r}=R("users"),t=e.usersList,s=d.useMemo(()=>[{key:"email",title:r("table.email"),render:p(({data:o})=>c.jsxs(X,{title:o.emailConfirmed?r("table.emailConfirmed"):r("table.emailNotConfirmed"),children:[o.email," ",o.emailConfirmed?c.jsx(Y,{style:{color:"var(--ant-color-success)"}}):c.jsx(Z,{style:{color:"var(--ant-color-warning)"}})]}))},{key:"telegram",title:r("table.telegram"),render:p(({data:o})=>o.telegram||"—")},{key:"name",title:r("table.name"),render:p(({data:o})=>o.name)},{key:"role",title:r("table.role"),render:p(({data:o})=>c.jsx(k,{children:r(`roles.${o.role}`,{ns:"common"})}))},{key:"status",title:r("table.status"),render:p(({data:o})=>{const l={active:r("status.active"),blocked:r("status.blocked"),frozen:r("status.frozen"),pending:r("status.pending"),review:r("status.review"),rejected:r("status.rejected")},i={active:"success",blocked:"error",frozen:"warning",pending:"processing",review:"processing",rejected:"error"}[o.status]||"default";return c.jsx(k,{color:i,children:l[o.status]||o.status})})},{key:"submittedAt",title:r("table.submittedAt"),render:p(({submittedAt:o})=>o?new Date(o).toLocaleDateString():"—"),responsive:["md"]},{key:"registeredAt",title:r("table.registeredAt"),render:p(({data:o})=>new Date(o.createdAt).toLocaleDateString()),responsive:["lg"]},{key:"actions",title:r("table.actions"),render:p(o=>c.jsx(Te,{...o})),fixed:"right"}],[r]);return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:b.table,children:c.jsx(ee,{rowKey:"id",loading:!t.query.isFetched&&{size:"large"},columns:s,pagination:!1,dataSource:t.data})}),c.jsx("div",{className:b.pagination,children:c.jsx(te,{current:t.currentPage,onChange:t.handlePagination,total:t.total,pageSize:t.limit})})]})}),$=P(function(){const{t:e}=R("users"),r=G(),t=J(()=>new qe(r),[r]);return c.jsx(W,{children:c.jsx(ne,{className:b.card,classNames:{body:b.body},title:c.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx("span",{children:e("moderation.title")}),c.jsx(A,{onClick:t.usersList.refresh,loading:t.usersList.query.isFetching,icon:c.jsx(oe,{})})]}),children:c.jsx(Ee,{model:t})})})}),Le=Object.freeze(Object.defineProperty({__proto__:null,ManagerModerationPage:$},Symbol.toStringTag,{value:"Module"})),ot=$;export{ot as component};
