import{f as b,m as D,e as _,P as w,k as M,S as B,r as v,t as q,o as p,j as e,R as K,s as W,u as G,a1 as z,aK as H}from"./index.CJpzWARr.js";import{G as T}from"./GridRow.DmVNsMLH.js";import"./AppLayout.Dd4AyXhP.js";import{L as U}from"./LayoutContainer.kUniMi3O.js";import{O as V,a as X,b as Y,c as Z,f as k,d as ee}from"./OfferPayoutRepository.DMRgHBdS.js";import{O as se}from"./OfferDomainRepository.C35Cl61S.js";import{u as g}from"./useTranslation.D1-YSIqG.js";import{B as O}from"./Box.CvVauy6S.js";import{C as m}from"./row.ZVKcDUTg.js";import{I as Q,L as te}from"./LanguageName.DxFQWD1J.js";import{T as N}from"./index.mfBRClzR.js";import{D as f}from"./index.BPpU5WLk.js";import{C as F}from"./Input.BJc5rBil.js";import{r as d}from"./renderReactiveCell.D7yC0G9H.js";import{C as L}from"./CountryName.Cqd_TUYv.js";import{D as R}from"./DateFormat.CyIrXEyF.js";import{T as S}from"./AntdIcon.BEv94oZ9.js";import{F as E}from"./Table.CnZn0sov.js";import{C}from"./Currency.Cy3QZbvy.js";import{F as re}from"./FlagIcon.DC8lzl7_.js";import{N as oe}from"./NumberFormat.TovQIcex.js";import"./index.5jmBMbM4.js";import"./button.CTAkPJpI.js";import"./EyeOutlined.C4wc5N2Y.js";import"./index.CvuYUNlW.js";import"./useClosable.Emosx8Km.js";import"./index.C7EzEdlH.js";import"./index.B7lSVg36.js";var ae=Object.defineProperty,ie=(n,s,t)=>s in n?ae(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t,y=(n,s,t)=>ie(n,typeof s!="symbol"?s+"":s,t);class ne{constructor(s,t,r){this.categoriesQuery=t,this.offerId=r,y(this,"offer"),y(this,"repositories"),y(this,"locations",b.array()),y(this,"basePayouts",b.array()),y(this,"personalPayouts",b.array()),y(this,"domains",b.array()),this.repositories={offer:s.repositories.get(Z),location:s.repositories.get(Y),basePayout:s.repositories.get(X),personalPayout:s.repositories.get(V),domain:s.repositories.get(se)},this.offer=this.repositories.offer.get(r),D(this,{category:_,landings:_({equals:w.shallow}),transits:_({equals:w.shallow}),updateFromJson:M})}get category(){return this.categoriesQuery.repository.get(this.offer.categoryId)}get landings(){return this.domains.filter(s=>s.type==="landing")}get transits(){return this.domains.filter(s=>s.type==="transit")}updateFromJson({locations:s,basePayouts:t,personalPayouts:r,domains:i,...l}){this.offer.updateFromJson({...l,locations:s.map(a=>a.id),basePayouts:t.map(a=>a.id),personalPayouts:r.map(a=>a.id),domains:i.map(a=>a.id)}),this.locations.replace(s.map(a=>this.repositories.location.get(a.id).updateFromJson(a))),this.basePayouts.replace(t.map(a=>this.repositories.basePayout.get(a.id).updateFromJson(a))),this.personalPayouts.replace(r.map(a=>this.repositories.personalPayout.get(a.id).updateFromJson(a))),this.domains.replace(i.map(a=>this.repositories.domain.get(a.id).updateFromJson(a)))}}class le extends B{constructor(s,t,r){const i=new ne(s,t,r);super(s.queryClient,{queryKey:["advertiser-offer",r],queryFn:()=>k.getAdimnOffersId({offerId:r}),onError:l=>{s.notify.toastError(l)},transform:l=>(l&&i.updateFromJson(l),i),staleTime:1e3*60*5}),this.categoriesQuery=t,this.offerId=r,D({locationsWithPayouts:_})}get store(){return this.data}get locationsWithPayouts(){const s=this.store.basePayouts,t=this.store.personalPayouts;return this.store.locations.map(r=>{const i=s.find(a=>a.locationId===r.id)||s[0],l=t.find(a=>a.locationId===r.id);return{id:r.id,location:r,basePayout:i,payout:l}})}updateFromJson(s){this.setQueryData(s,{updatedAt:Date.now()})}}var ce=Object.defineProperty,de=(n,s,t)=>s in n?ce(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t,I=(n,s,t)=>de(n,typeof s!="symbol"?s+"":s,t);class ue{constructor(s,t){I(this,"offerQuery"),I(this,"categoriesQuery"),this.categoriesQuery=new ee(s),this.offerQuery=new le(s,this.categoriesQuery,t),q(this,{},{autoBind:!0})}dispose(){console.log("dispose")}init(){console.log("init")}}const me=v.createContext(null),pe="_section_1cu6l_1",x={section:pe},fe="_tags_1bona_1",A={tags:fe},ye=p(function({offerQuery:s}){const{t,locale:r}=g("offer"),i=s.store.offer,l=s.store.category;return e.jsxs(T,{vGutter:12,children:[e.jsx(m,{xs:24,sm:10,md:10,lg:10,xl:11,xxl:12,children:e.jsx(Q,{className:A.image,src:i.image,alt:i.title})}),e.jsxs(m,{xs:24,sm:14,md:14,lg:14,xl:13,xxl:12,children:[e.jsxs(O,{className:A.tags,children:[i.isTopOffer&&e.jsx(N,{color:"blue",children:t("status.isTopOffer")}),i.isExclusive&&e.jsx(N,{color:"purple",children:t("status.isExclusive")})]}),e.jsxs(f,{layout:"horizontal",children:[e.jsx(f.Item,{span:"filled",label:t("page.vertical"),children:t(`vertical.${i.vertical}`)}),e.jsx(f.Item,{span:"filled",label:t("page.category"),children:r.code==="ru"?l.nameRu:l.nameEn}),e.jsx(f.Item,{span:"filled",label:t("page.description"),children:i.subtitle}),e.jsx(f.Item,{span:"filled",label:"CR",children:i.cr}),e.jsx(f.Item,{span:"filled",label:t("page.approve"),children:i.approve})]})]}),e.jsxs(m,{xs:24,children:[e.jsxs("h5",{children:[t("page.rules"),":"]}),e.jsx("p",{children:i.rules})]})]})}),ge=p(function({offerQuery:s}){const{t}=g("offer"),r=s.store.offer;return e.jsx(F,{title:`${t("page.offer")}: ${r.title}`,children:e.jsx(ye,{offerQuery:s})})}),xe="_card_42l30_1",he="_card_body_42l30_5",je="_table_42l30_9",be="_image_42l30_34",_e="_secondary_42l30_38",h={card:xe,card_body:he,table:je,image:be,secondary:_e},ve={body:h.card_body},$=p(function({type:s,offerQuery:t}){const{t:r}=g("offer");return e.jsx(F,{title:`${r(`page.${s}`)}`,className:h.card,classNames:ve,children:e.jsx(Pe,{offerQuery:t,type:s})})}),Pe=p(function({type:s,offerQuery:t}){const{t:r}=g("offer"),i=s==="landing"?t.store.landings:t.store.transits,l=t.store.locations,a=v.useMemo(()=>[{title:r("domains.image"),render:d(({domain:o})=>e.jsx(O,{gap:"xs",align:"center",justify:"start",onClick:c=>c.stopPropagation(),children:e.jsx(Q,{className:h.image,src:o.image,alt:o.title})}))},{title:r("domains.geo"),render:d(({location:o})=>e.jsx(L,{code:o.country}))},{title:r("domains.languages"),render:d(({domain:o})=>{const c=o.languages.map((j,J)=>e.jsxs(K.Fragment,{children:[e.jsx(te,{code:j}),J<o.languages.length-1&&e.jsx("br",{})]},j));return o.languages.length>4?e.jsx(S,{overlay:c,children:e.jsxs(N,{children:[" ",o.languages.length," "]})}):c})},{title:"CR",render:d(({domain:o})=>o.cr)},{title:r("domains.updated"),render:d(({domain:o})=>e.jsxs(e.Fragment,{children:[e.jsx(R,{value:o.updatedAt||o.createdAt,dateStyle:"short"}),e.jsx("br",{}),e.jsx("span",{className:h.secondary,children:e.jsx(R,{value:o.updatedAt||o.createdAt,timeStyle:"short"})})]}))}],[r]),P=i.map(o=>{const c=l.find(j=>j.id===o.id)||l[0];return{id:o.id,location:c,domain:o}});return e.jsx(E,{rowKey:"id",columns:a,pagination:!1,dataSource:P,className:h.table})}),Ce="_card_17bcj_1",Ne="_card_body_17bcj_5",Oe="_table_17bcj_9",Fe="_payoutModified_17bcj_50",we="_payoutCell_17bcj_56",Re="_priceCell_17bcj_60",u={card:Ce,card_body:Ne,table:Oe,payoutModified:Fe,payoutCell:we,priceCell:Re},Ie={y:512},Ae=p(function({offerQuery:s,size:t,scroll:r=Ie}){const{t:i}=g("offer"),l=v.useMemo(()=>[{title:i("card.country"),dataIndex:"country",key:"country",render:d(({location:o})=>e.jsxs(O,{nowrap:!0,align:"center",gap:"xs",children:[e.jsx(re,{code:o.country}),e.jsx(L,{code:o.country})]}))},{title:i("card.payout"),dataIndex:"payout",key:"payout",render:d(({payout:o,basePayout:c})=>o?e.jsx(S,{overlay:i("card.personalPayoutTooltip",{diff:e.jsx(oe,{signDisplay:"always",value:o.amount-c.amount})}),children:e.jsx("div",{className:W(u.payoutCell,u.payoutModified),children:e.jsx(C,{code:o.currency,value:o.amount})})}):e.jsx("div",{className:u.payoutCell,children:e.jsx(C,{code:c.currency,value:c.amount})})),width:96},{title:i("card.sitePrice"),dataIndex:"sitePrice",key:"sitePrice",render:d(({location:o})=>e.jsx("div",{className:u.priceCell,children:e.jsx(C,{code:o.currency,value:o.price})})),width:108}],[i]),a=s.locationsWithPayouts,P=v.useMemo(()=>({defaultExpandAllRows:!0,expandedRowRender:o=>e.jsx(e.Fragment,{children:e.jsx("p",{style:{margin:0},children:o.location.locationRestrictions})}),showExpandColumn:!1}),[]);return e.jsx(E,{rowKey:"id",size:t,columns:l,pagination:!1,dataSource:a,className:u.table,scroll:r||void 0,loading:!s.isFetched&&s.isFetching,expandable:P})}),$e={body:u.card_body},De=p(function({offerQuery:s}){const{t}=g("offer");return e.jsx(F,{classNames:$e,className:u.card,title:`${t("page.geo")}`,children:e.jsx(Ae,{offerQuery:s})})}),Te=p(function({offerId:s}){const t=G(),r=z(()=>new ue(t,s),[t,s]);return e.jsx(me.Provider,{value:r,children:e.jsx(U,{className:x.container,children:e.jsxs(T,{children:[e.jsx(m,{xs:24,xxl:12,className:x.section,children:e.jsx(ge,{offerQuery:r.offerQuery})}),e.jsx(m,{xs:24,xxl:12,className:x.section,children:e.jsx(De,{offerQuery:r.offerQuery})}),e.jsx(m,{xs:24,xxl:12,className:x.section,children:e.jsx($,{offerQuery:r.offerQuery,type:"landing"})}),e.jsx(m,{xs:24,xxl:12,className:x.section,children:e.jsx($,{offerQuery:r.offerQuery,type:"transit"})})]})})})}),cs=()=>{const{offerId:n}=H.useParams();return e.jsx(Te,{offerId:n})};export{cs as component};
