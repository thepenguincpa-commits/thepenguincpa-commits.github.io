import{x as v,S as C,t as l,a0 as d,o as g,j as s}from"./index.WsYO2dy-.js";import{P as b,p,a as T}from"./PostbackConfigFormGroup.DxpfzYxI.js";import{R as _}from"./Registry.HwMJU2b-.js";import{T as h}from"./Toggler.ZA2mSsXC.js";import{u as f}from"./useTranslation.Bt2PYRL2.js";import{B as y}from"./Box.BoA2lbt8.js";import{M as k}from"./index.BeMCciVP.js";import{b as a}from"./validators.Dv5Q2cT2.js";import{I as P}from"./index.BtpR5D5L.js";import{S as x}from"./index.DGsLj2m-.js";import{B as u}from"./button.B3PsbA3S.js";class w extends v{constructor(){super(t=>new b(t))}}class I extends C{constructor(t,e,i){super(t.queryClient,{queryKey:["postbacks",e,i],queryFn:async()=>p.getPostbacks({type:e,campaignId:i}),transform:(o=[])=>{const m=t.repositories.get(w);return{items:o.map(j=>m.get(j.id)),repository:m}},staleTime:1e3*60*5,refetchOnWindowFocus:!0})}get repository(){return this.data.repository}get items(){return this.data.items}}var S=Object.defineProperty,q=(r,t,e)=>t in r?S(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,E=(r,t,e)=>q(r,t+"",e);class F{constructor(t,e){E(this,"group"),this.group=new T(t,e),l(this,{},{autoBind:!0})}get url(){return this.group.controls.url}get eventTypes(){return this.group.controls.eventTypes}}var M=Object.defineProperty,$=(r,t,e)=>t in r?M(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,c=(r,t,e)=>$(r,typeof t!="symbol"?t+"":t,e);class B{constructor(t,e){c(this,"form"),c(this,"mutation"),c(this,"id"),this.form=new F(t,e),this.id=e.id,this.mutation=new d(t.queryClient,{mutationFn:i=>p.patchPostbacksPostbackId({postbackId:e.id,postbackConfigUpdateDto:i}),onError:i=>{t.notify.toastError(i)}}),l(this,{},{autoBind:!0})}handleSubmit(){if(this.form.group.isInvalid){this.form.group.setTouched(!0),this.form.group.setDirty(!0),this.form.group.firstErrorControl?.element?.focus();return}this.mutation.mutate(this.form.group.changedValue)}}var O=Object.defineProperty,R=(r,t,e)=>t in r?O(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,n=(r,t,e)=>R(r,typeof t!="symbol"?t+"":t,e);class X{constructor(t,e){this.appContext=t,this.campaign=e,n(this,"addMutation"),n(this,"createForm"),n(this,"query"),n(this,"type"),n(this,"registry",new _(i=>new B(this.appContext,i))),n(this,"createToggler",new h(!1)),n(this,"detailsToggler",new h(!1)),this.type=e===null?"global":"campaign",this.createForm=new F(t,new b("new")),this.query=new I(t,this.type,e?.id),this.addMutation=new d(t.queryClient,{mutationFn:i=>p.postPostbacks({postbackConfigCreateDto:i})}),l(this,{},{autoBind:!0})}get title(){const t=this.appContext.locale.translations.postback;return this.campaign?`${this.campaign?.name}: ${t("title.campaign")}`:t("title.global")}get count(){return this.postbacks.length}get postbacks(){return this.registry.from(this.query.items)}get isEmpty(){return this.postbacks.length===0}handleOpenCreateForm(){this.createForm.group.reset(),this.createToggler.enable()}handleSubmitCreate(){if(this.createForm.group.isInvalid){this.createForm.group.setTouched(!0),this.createForm.group.setDirty(!0),this.createForm.group.firstErrorControl?.element?.focus?.();return}const t=this.createForm.group.value;this.addMutation.mutate({campaignId:this.campaign?.id,type:this.campaign?"campaign":"global",userId:this.appContext.auth.userId,...t})}}const N={},Y=g(function({model:t}){const e=t.createForm,{t:i}=f("common");return s.jsxs("div",{className:N.container,children:[t.postbacks.map(o=>s.jsx(D,{handleSubmit:o.handleSubmit,form:o.form,mutation:o.mutation},o.id)),s.jsx(k,{centered:!0,open:t.createToggler.isEnabled,onCancel:t.createToggler.disable,footer:s.jsxs(y,{justify:"end",gap:"xs",children:[s.jsx(u,{onClick:t.createToggler.disable,children:i("buttons.cancel")}),s.jsx(u,{disabled:!e.group.isChanged,onClick:e.group.reset,children:i("buttons.reset")}),s.jsx(u,{type:"primary",disabled:!e.group.isChanged,onClick:t.handleSubmitCreate,loading:t.addMutation.isPending,children:i("buttons.submit")})]}),children:s.jsxs(a,{layout:"vertical",onFinish:t.handleSubmitCreate,children:[s.jsx(a.Item,{...e.url.itemProps,children:s.jsx(P,{...e.url.inputProps})}),s.jsx(a.Item,{...e.eventTypes.itemProps,children:s.jsx(x,{...e.eventTypes.inputProps})})]})})]})}),D=g(function({form:t,handleSubmit:e,mutation:i}){const{t:o}=f("common");return s.jsxs(a,{layout:"vertical",onFinish:e,children:[s.jsx(a.Item,{...t.url.itemProps,children:s.jsx(P,{...t.url.inputProps})}),s.jsx(a.Item,{...t.eventTypes.itemProps,children:s.jsx(x,{...t.eventTypes.inputProps})}),s.jsxs(y,{justify:"end",gap:"xs",children:[s.jsx(u,{disabled:!t.group.isChanged,onClick:t.group.reset,children:o("buttons.reset")}),s.jsx(u,{type:"primary",disabled:!t.group.isChanged,onClick:e,loading:i.isPending,children:o("buttons.save")})]})]})});export{X as P,Y as a};
