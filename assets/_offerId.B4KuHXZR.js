import{R as ae,r as u,d as O,e as je,m as xe,h as ve,f as v,a0 as Oe,i as $e,q as Ce,A as _e,D as C,E as w,n as Ne,o as I,j as r,u as Se,b5 as we}from"./index.D0ZL9dlq.js";import{T as oe,u as Pe}from"./useStore.rIWB3VHp.js";import{G as re}from"./GridRow.BSx-bdOS.js";import"./AppLayout.C4AKfawf.js";import{a as Ee}from"./LayoutContainer.D5vzTIRK.js";import{O as Z,a as Re,b as Ie,c as Me,d as ze,o as Be,e as qe,B as J,C as ne}from"./CountryName.CgLtou_u.js";import{Q as Te,u as X}from"./QueryWithState.BPq9GHGk.js";import{m as le,u as Le,C as K}from"./EyeOutlined.BTRVFJFJ.js";import{C as R}from"./row.BNxq_Flf.js";import{a as ie,L as Fe}from"./LanguageName.OzAHH5kB.js";import{T as Q}from"./index.Bl3kKYWx.js";import{t as De,u as We,B as Ae}from"./button.OEP3CgYZ.js";import{r as _,F as ce}from"./renderReactiveCell.B_zzU_Pl.js";import{D as k}from"./DateFormat.BM9lf7mQ.js";import{F as Ge,C as W}from"./FlagIcon.DW-Y8Ccx.js";import{N as He}from"./NumberFormat.DxvU6q7R.js";import"./index.qEyMnBBk.js";import"./index.CA_kN61l.js";import"./index.ClGRLJ6f.js";const Qe={xxl:3,xl:3,lg:3,md:3,sm:2,xs:1},V=ae.createContext({});var Je=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(s[a[o]]=e[a[o]]);return s};const Xe=e=>De(e).map(t=>Object.assign(Object.assign({},t?.props),{key:t.key}));function Ke(e,t,s){const a=u.useMemo(()=>t||Xe(s),[t,s]);return u.useMemo(()=>a.map(d=>{var{span:i}=d,l=Je(d,["span"]);return i==="filled"?Object.assign(Object.assign({},l),{filled:!0}):Object.assign(Object.assign({},l),{span:typeof i=="number"?i:le(e,i)})}),[a,e])}var Ve=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(s[a[o]]=e[a[o]]);return s};function Ue(e,t){let s=[],a=[],o=!1,d=0;return e.filter(i=>i).forEach(i=>{const{filled:l}=i,n=Ve(i,["filled"]);if(l){a.push(n),s.push(a),a=[],d=0;return}const m=t-d;d+=i.span||1,d>=t?(d>t?(o=!0,a.push(Object.assign(Object.assign({},n),{span:m}))):a.push(n),s.push(a),a=[],d=0):a.push(n)}),a.length>0&&s.push(a),s=s.map(i=>{const l=i.reduce((n,m)=>n+(m.span||1),0);if(l<t){const n=i[i.length-1];return n.span=t-(l-(n.span||1)),i}return i}),[s,o]}const Ye=(e,t)=>{const[s,a]=u.useMemo(()=>Ue(t,e),[t,e]);return s},Ze=({children:e})=>e;function ee(e){return e!=null}const A=e=>{const{itemPrefixCls:t,component:s,span:a,className:o,style:d,labelStyle:i,contentStyle:l,bordered:n,label:m,content:p,colon:h,type:j,styles:f}=e,x=s,g=u.useContext(V),{classNames:c}=g;return n?u.createElement(x,{className:O({[`${t}-item-label`]:j==="label",[`${t}-item-content`]:j==="content",[`${c?.label}`]:j==="label",[`${c?.content}`]:j==="content"},o),style:d,colSpan:a},ee(m)&&u.createElement("span",{style:Object.assign(Object.assign({},i),f?.label)},m),ee(p)&&u.createElement("span",{style:Object.assign(Object.assign({},i),f?.content)},p)):u.createElement(x,{className:O(`${t}-item`,o),style:d,colSpan:a},u.createElement("div",{className:`${t}-item-container`},(m||m===0)&&u.createElement("span",{className:O(`${t}-item-label`,c?.label,{[`${t}-item-no-colon`]:!h}),style:Object.assign(Object.assign({},i),f?.label)},m),(p||p===0)&&u.createElement("span",{className:O(`${t}-item-content`,c?.content),style:Object.assign(Object.assign({},l),f?.content)},p)))};function G(e,{colon:t,prefixCls:s,bordered:a},{component:o,type:d,showLabel:i,showContent:l,labelStyle:n,contentStyle:m,styles:p}){return e.map(({label:h,children:j,prefixCls:f=s,className:x,style:g,labelStyle:c,contentStyle:b,span:L=1,key:M,styles:y},z)=>typeof o=="string"?u.createElement(A,{key:`${d}-${M||z}`,className:x,style:g,styles:{label:Object.assign(Object.assign(Object.assign(Object.assign({},n),p?.label),c),y?.label),content:Object.assign(Object.assign(Object.assign(Object.assign({},m),p?.content),b),y?.content)},span:L,colon:t,component:o,itemPrefixCls:f,bordered:a,label:i?h:null,content:l?j:null,type:d}):[u.createElement(A,{key:`label-${M||z}`,className:x,style:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n),p?.label),g),c),y?.label),span:1,colon:t,component:o[0],itemPrefixCls:f,bordered:a,label:h,type:"label"}),u.createElement(A,{key:`content-${M||z}`,className:x,style:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},m),p?.content),g),b),y?.content),span:L*2-1,component:o[1],itemPrefixCls:f,bordered:a,content:j,type:"content"})])}const ke=e=>{const t=u.useContext(V),{prefixCls:s,vertical:a,row:o,index:d,bordered:i}=e;return a?u.createElement(u.Fragment,null,u.createElement("tr",{key:`label-${d}`,className:`${s}-row`},G(o,e,Object.assign({component:"th",type:"label",showLabel:!0},t))),u.createElement("tr",{key:`content-${d}`,className:`${s}-row`},G(o,e,Object.assign({component:"td",type:"content",showContent:!0},t)))):u.createElement("tr",{key:d,className:`${s}-row`},G(o,e,Object.assign({component:i?["th","td"]:"td",type:"item",showLabel:!0,showContent:!0},t)))},et=e=>{const{componentCls:t,labelBg:s}=e;return{[`&${t}-bordered`]:{[`> ${t}-view`]:{border:`${v(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"> table":{tableLayout:"auto"},[`${t}-row`]:{borderBottom:`${v(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"&:first-child":{"> th:first-child, > td:first-child":{borderStartStartRadius:e.borderRadiusLG}},"&:last-child":{borderBottom:"none","> th:first-child, > td:first-child":{borderEndStartRadius:e.borderRadiusLG}},[`> ${t}-item-label, > ${t}-item-content`]:{padding:`${v(e.padding)} ${v(e.paddingLG)}`,borderInlineEnd:`${v(e.lineWidth)} ${e.lineType} ${e.colorSplit}`,"&:last-child":{borderInlineEnd:"none"}},[`> ${t}-item-label`]:{color:e.colorTextSecondary,backgroundColor:s,"&::after":{display:"none"}}}},[`&${t}-middle`]:{[`${t}-row`]:{[`> ${t}-item-label, > ${t}-item-content`]:{padding:`${v(e.paddingSM)} ${v(e.paddingLG)}`}}},[`&${t}-small`]:{[`${t}-row`]:{[`> ${t}-item-label, > ${t}-item-content`]:{padding:`${v(e.paddingXS)} ${v(e.padding)}`}}}}}},tt=e=>{const{componentCls:t,extraColor:s,itemPaddingBottom:a,itemPaddingEnd:o,colonMarginRight:d,colonMarginLeft:i,titleMarginBottom:l}=e;return{[t]:Object.assign(Object.assign(Object.assign({},ve(e)),et(e)),{"&-rtl":{direction:"rtl"},[`${t}-header`]:{display:"flex",alignItems:"center",marginBottom:l},[`${t}-title`]:Object.assign(Object.assign({},Oe),{flex:"auto",color:e.titleColor,fontWeight:e.fontWeightStrong,fontSize:e.fontSizeLG,lineHeight:e.lineHeightLG}),[`${t}-extra`]:{marginInlineStart:"auto",color:s,fontSize:e.fontSize},[`${t}-view`]:{width:"100%",borderRadius:e.borderRadiusLG,table:{width:"100%",tableLayout:"fixed",borderCollapse:"collapse"}},[`${t}-row`]:{"> th, > td":{paddingBottom:a,paddingInlineEnd:o},"> th:last-child, > td:last-child":{paddingInlineEnd:0},"&:last-child":{borderBottom:"none","> th, > td":{paddingBottom:0}}},[`${t}-item-label`]:{color:e.labelColor,fontWeight:"normal",fontSize:e.fontSize,lineHeight:e.lineHeight,textAlign:"start","&::after":{content:'":"',position:"relative",top:-.5,marginInline:`${v(i)} ${v(d)}`},[`&${t}-item-no-colon::after`]:{content:'""'}},[`${t}-item-no-label`]:{"&::after":{margin:0,content:'""'}},[`${t}-item-content`]:{display:"table-cell",flex:1,color:e.contentColor,fontSize:e.fontSize,lineHeight:e.lineHeight,wordBreak:"break-word",overflowWrap:"break-word"},[`${t}-item`]:{paddingBottom:0,verticalAlign:"top","&-container":{display:"flex",[`${t}-item-label`]:{display:"inline-flex",alignItems:"baseline"},[`${t}-item-content`]:{display:"inline-flex",alignItems:"baseline",minWidth:"1em"}}},"&-middle":{[`${t}-row`]:{"> th, > td":{paddingBottom:e.paddingSM}}},"&-small":{[`${t}-row`]:{"> th, > td":{paddingBottom:e.paddingXS}}}})}},st=e=>({labelBg:e.colorFillAlter,labelColor:e.colorTextTertiary,titleColor:e.colorText,titleMarginBottom:e.fontSizeSM*e.lineHeightSM,itemPaddingBottom:e.padding,itemPaddingEnd:e.padding,colonMarginRight:e.marginXS,colonMarginLeft:e.marginXXS/2,contentColor:e.colorText,extraColor:e.colorText}),at=je("Descriptions",e=>{const t=xe(e,{});return tt(t)},st);var ot=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(s[a[o]]=e[a[o]]);return s};const P=e=>{const{prefixCls:t,title:s,extra:a,column:o,colon:d=!0,bordered:i,layout:l,children:n,className:m,rootClassName:p,style:h,size:j,labelStyle:f,contentStyle:x,styles:g,items:c,classNames:b}=e,L=ot(e,["prefixCls","title","extra","column","colon","bordered","layout","children","className","rootClassName","style","size","labelStyle","contentStyle","styles","items","classNames"]),{getPrefixCls:M,direction:y,className:z,style:ue,classNames:N,styles:S}=$e("descriptions"),$=M("descriptions",t),F=Le(),me=u.useMemo(()=>{var B;return typeof o=="number"?o:(B=le(F,Object.assign(Object.assign({},Qe),o)))!==null&&B!==void 0?B:3},[F,o]),pe=Ke(F,c,n),D=We(j),ge=Ye(me,pe),[fe,be,ye]=at($),he=u.useMemo(()=>({labelStyle:f,contentStyle:x,styles:{content:Object.assign(Object.assign({},S.content),g?.content),label:Object.assign(Object.assign({},S.label),g?.label)},classNames:{label:O(N.label,b?.label),content:O(N.content,b?.content)}}),[f,x,g,b,N,S]);return fe(u.createElement(V.Provider,{value:he},u.createElement("div",Object.assign({className:O($,z,N.root,b?.root,{[`${$}-${D}`]:D&&D!=="default",[`${$}-bordered`]:!!i,[`${$}-rtl`]:y==="rtl"},m,p,be,ye),style:Object.assign(Object.assign(Object.assign(Object.assign({},ue),S.root),g?.root),h)},L),(s||a)&&u.createElement("div",{className:O(`${$}-header`,N.header,b?.header),style:Object.assign(Object.assign({},S.header),g?.header)},s&&u.createElement("div",{className:O(`${$}-title`,N.title,b?.title),style:Object.assign(Object.assign({},S.title),g?.title)},s),a&&u.createElement("div",{className:O(`${$}-extra`,N.extra,b?.extra),style:Object.assign(Object.assign({},S.extra),g?.extra)},a)),u.createElement("div",{className:`${$}-view`},u.createElement("table",null,u.createElement("tbody",null,ge.map((B,Y)=>u.createElement(ke,{key:Y,index:Y,colon:d,prefixCls:$,vertical:l==="vertical",bordered:i,row:B}))))))))};P.Item=Ze;var rt=Object.defineProperty,nt=(e,t,s)=>t in e?rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,lt=(e,t,s)=>nt(e,t+"",s);class it{constructor(t,s,a){this.offerId=s,this.categoriesQuery=a,lt(this,"query");const o=t.repositories.get(Z),d=t.repositories.get(Re),i=t.repositories.get(Ie),l=t.repositories.get(Me),n=t.repositories.get(ze);this.query=new Te(t.queryClient,{queryKey:["offer",s],queryFn:()=>Be.offersIdGet({id:s}),onError:m=>{Ce(m).then(p=>{t.notify.error({message:p.message})})},transform:m=>{const p=t.repositories.get(Z).get(s);if(m){const{locations:h,basePayouts:j,personalPayouts:f,domains:x,...g}=m;return{offer:o.get(g.id).updateFromJson({...g,locations:h.map(c=>c.id),basePayouts:j.map(c=>c.id),personalPayouts:f.map(c=>c.id),domains:x.map(c=>c.id)}),locations:h.map(c=>d.get(c.id).updateFromJson(c)),basePayouts:j.map(c=>i.get(c.id).updateFromJson(c)),personalPayouts:f.map(c=>l.get(c.id).updateFromJson(c)),domains:x.map(c=>n.get(c.id).updateFromJson(c)),offerRepository:o,locationRepository:d,basePayoutRepository:i,personalPayoutRepository:l,domainRepository:n}}return{offer:p,locations:[],basePayouts:[],personalPayouts:[],domains:[],offerRepository:o,locationRepository:d,basePayoutRepository:i,personalPayoutRepository:l,domainRepository:n}},staleTime:1e3*60*5}),_e(this,{offer:C,category:C,locations:C({equals:w.shallow}),basePayouts:C({equals:w.shallow}),personalPayouts:C({equals:w.shallow}),domains:C({equals:w.shallow}),landings:C({equals:w.shallow}),transits:C({equals:w.shallow}),repositories:C({equals:w.shallow})})}get repositories(){return{offer:this.query.data.offerRepository,locations:this.query.data.locationRepository,basePayouts:this.query.data.basePayoutRepository,domains:this.query.data.domainRepository,personalPayouts:this.query.data.personalPayoutRepository}}get offer(){return this.query.data.offer}get category(){return this.categoriesQuery.repository.get(this.offer.category)}get locations(){return this.query.data.locations}get basePayouts(){return this.query.data.basePayouts}get personalPayouts(){return this.query.data.personalPayouts}get domains(){return this.query.data.domains}get landings(){return this.query.data.domains.filter(t=>t.type==="landing")}get transits(){return this.query.data.domains.filter(t=>t.type==="transit")}}var ct=Object.defineProperty,dt=(e,t,s)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,te=(e,t,s)=>dt(e,typeof t!="symbol"?t+"":t,s);class ut{constructor(t,s){te(this,"offerStore"),te(this,"categoriesQuery"),this.categoriesQuery=new qe(t),this.offerStore=new it(t,s,this.categoriesQuery),Ne(this,{},{autoBind:!0})}dispose(){console.log("dispose")}init(){console.log("init")}}const de=u.createContext(null);function U(){const e=u.useContext(de);if(!e)throw new Error("Необходимо зарегистрировать провайдер WebmasterOfferModelContext");return e}const mt="_image_a590z_1",pt="_rules_a590z_5",gt="_tags_a590z_9",H={image:mt,rules:pt,tags:gt},ft=I(function(){const t=U(),{t:s,locale:a}=X("offer"),o=t.offerStore.offer,d=t.offerStore.category;return r.jsxs(K,{title:`${s("page.offer")}: ${o.title}`,extra:r.jsx(r.Fragment,{children:r.jsx(Ae,{type:"primary",children:"Подключить оффер"})}),children:[r.jsxs(re,{children:[r.jsx(R,{xs:24,sm:8,md:8,lg:10,children:r.jsx(ie,{className:H.image,src:o.image,alt:o.title})}),r.jsxs(R,{xs:24,sm:16,md:16,lg:14,children:[r.jsxs(J,{className:H.tags,children:[o.isTopOffer&&r.jsx(Q,{color:"blue",children:s("status.isTopOffer")}),o.isExclusive&&r.jsx(Q,{color:"purple",children:s("status.isExclusive")})]}),r.jsxs(P,{layout:"horizontal",children:[r.jsx(P.Item,{span:"filled",label:s("page.vertical"),children:s(`vertical.${o.vertical}`)}),r.jsx(P.Item,{span:"filled",label:s("page.category"),children:a.code==="ru"?d.nameRu:d.nameEn}),r.jsx(P.Item,{span:"filled",label:s("page.description"),children:o.subtitle}),r.jsx(P.Item,{span:"filled",label:"CR",children:o.cr}),r.jsx(P.Item,{span:"filled",label:s("page.approve"),children:o.approve})]})]})]}),r.jsxs("p",{className:H.rules,children:[r.jsxs("b",{children:[s("page.rules"),": "]}),o.rules]})]})}),bt="_card_114nr_1",yt="_card_body_114nr_1",ht="_table_114nr_6",jt="_image_114nr_31",T={card:bt,card_body:yt,table:ht,image:jt},xt={body:T.card_body},se=I(function({type:t}){const{t:s}=X("offer");return r.jsx(K,{title:`${s(`page.${t}`)}`,className:T.card,classNames:xt,children:r.jsx(vt,{type:t})})}),vt=I(function({type:t}){const s=U(),a=t==="landing"?s.offerStore.landings:s.offerStore.transits,o=s.offerStore.locations,d=u.useMemo(()=>[{title:"Изображение",render:_(({domain:l})=>r.jsx(J,{gap:"xs",align:"center",justify:"start",onClick:n=>n.stopPropagation(),children:r.jsx(ie,{className:T.image,src:l.image,alt:l.title})}))},{title:"Гео",render:_(({location:l})=>r.jsx(ne,{code:l.countryCode}))},{title:"Языки",render:_(({domain:l})=>{const n=l.languages.map((m,p)=>r.jsxs(ae.Fragment,{children:[r.jsx(Fe,{code:m}),p<l.languages.length-1&&r.jsx("br",{})]},m));return l.languages.length>4?r.jsx(oe,{overlay:n,children:r.jsxs(Q,{children:[" ",l.languages.length," "]})}):n})},{title:"CR",render:_(({domain:l})=>l.cr)},{title:"Обновлён",render:_(({domain:l})=>r.jsxs(r.Fragment,{children:[r.jsx(k,{value:l.updatedAt||l.createdAt,dateStyle:"short"}),r.jsx("br",{}),r.jsx("span",{className:T.secondary,children:r.jsx(k,{value:l.updatedAt||l.createdAt,timeStyle:"short"})})]}))}],[]),i=a.map(l=>{const n=o.find(m=>m.id===l.id)||o[0];return{id:l.id,location:n,domain:l}});return r.jsx(ce,{rowKey:"id",columns:d,pagination:!1,dataSource:i,className:T.table})}),Ot="_card_1lz2j_1",$t="_card_body_1lz2j_1",Ct="_table_1lz2j_5",_t="_payoutModified_1lz2j_36",Nt="_payoutCell_1lz2j_42",St="_priceCell_1lz2j_46",E={card:Ot,card_body:$t,table:Ct,payoutModified:_t,payoutCell:Nt,priceCell:St},wt={body:E.card_body},Pt=I(function(){const{t}=X("offer");return r.jsx(K,{classNames:wt,className:E.card,title:`${t("page.geo")}`,children:r.jsx(Et,{})})}),Et=I(function(){const s=U().offerStore,a=u.useMemo(()=>[{title:"Страна",dataIndex:"country",key:"country",width:"100%",render:_(({location:n})=>r.jsxs(J,{align:"center",gap:"xs",children:[r.jsx(Ge,{code:n.countryCode}),r.jsx(ne,{code:n.countryCode})]}))},{title:"Выпл. $",dataIndex:"payout",key:"payout",render:_(({payout:n,basePayout:m})=>n?r.jsx(oe,{overlay:`Специальные условия: ${r.jsx(He,{signDisplay:"always",value:n.amount-m.amount})}`,children:r.jsx("div",{className:O(E.payoutCell,E.payoutModified),children:r.jsx(W,{code:n.currency,value:n.amount})})}):r.jsx("div",{className:E.payoutCell,children:r.jsx(W,{code:m.currency,value:m.amount})}))},{title:"На сайте",dataIndex:"sitePrice",key:"sitePrice",render:_(({location:n})=>r.jsx("div",{className:E.priceCell,children:r.jsx(W,{code:n.currency,value:n.price})}))}],[]),{locations:o,basePayouts:d,personalPayouts:i}=s,l=o.map(n=>{const m=d.find(h=>h.location===n.id)||d[0],p=i.find(h=>h.location===n.id);return{id:n.id,location:n,basePayout:m,payout:p}});return r.jsx(ce,{rowKey:"id",columns:a,pagination:!1,dataSource:l,className:E.table})}),Rt="_section_1cu6l_1",q={section:Rt},It=I(function({offerId:t}){const s=Se(),a=Pe(()=>new ut(s,t),[s,t]);return r.jsx(de.Provider,{value:a,children:r.jsx(Ee,{className:q.container,children:r.jsxs(re,{children:[r.jsx(R,{xs:24,xl:12,className:q.section,children:r.jsx(ft,{})}),r.jsx(R,{xs:24,xl:12,className:q.section,children:r.jsx(Pt,{})}),r.jsx(R,{xs:24,xl:12,className:q.section,children:r.jsx(se,{type:"landing"})}),r.jsx(R,{xs:24,xl:12,className:q.section,children:r.jsx(se,{type:"transit"})})]})})})}),Zt=()=>{const e=we.useParams();return r.jsx(It,{offerId:e.offerId})};export{Zt as component};
