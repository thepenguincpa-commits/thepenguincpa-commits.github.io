import{F as X,r as f,t as T,k as $,a0 as S,aZ as Y,o as P,u as L,a1 as F,j as a,R as g,a_ as oe,S as ie,a$ as G}from"./index.CJpzWARr.js";import{C as le}from"./row.ZVKcDUTg.js";import{G as z}from"./GridRow.DmVNsMLH.js";import{L as ue}from"./LayoutContainer.kUniMi3O.js";import{c as d,r as x,n as q,m as _,V as de,a as A,b as i,F as ce,e as me,p as pe}from"./validators.puhu6pph.js";import{u as he}from"./useTranslation.DVdJGqhZ.js";import{C as U}from"./Input.BJc5rBil.js";import{I as c}from"./index.UwxdIMsP.js";import{I as ee}from"./AntdIcon.BEv94oZ9.js";import{F as I}from"./index.D5519FJg.js";import{B as u}from"./button.CTAkPJpI.js";import{u as te}from"./useTranslation.D1-YSIqG.js";import{U as fe,R as ge}from"./LoadingOutlined.Cz2lff6F.js";import{R as xe,a as ye}from"./PlusOutlined.CmczRP0s.js";import{R as we}from"./UserOutlined.BUK8xTnV.js";import{P as be,O as je,L as N}from"./OverlayLoader.CkmuvXKQ.js";import{T as Pe}from"./Toggler.Bo1KxCe6.js";import{P as ve}from"./index.Dr9pHSB9.js";import{R as Ce}from"./DeleteOutlined.CRLqQ2Y8.js";import{M as Oe}from"./index.CnCisG79.js";import{R as _e}from"./SyncOutlined.DPlxgDWy.js";import"./EyeOutlined.C4wc5N2Y.js";import"./index.C7EzEdlH.js";import"./index.CvuYUNlW.js";import"./ActionButton.D2hXE_0n.js";import"./useClosable.Emosx8Km.js";var C={},H;function Se(){if(H)return C;H=1,Object.defineProperty(C,"__esModule",{value:!0});var s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};return C.default=s,C}var Ie=Se();const Me=X(Ie);function V(){return V=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},V.apply(this,arguments)}const Ee=(s,e)=>f.createElement(ee,V({},s,{ref:e,icon:Me})),R=f.forwardRef(Ee);var O={},J;function Te(){if(J)return O;J=1,Object.defineProperty(O,"__esModule",{value:!0});var s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};return O.default=s,O}var Le=Te();const Fe=X(Le);function D(){return D=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},D.apply(this,arguments)}const qe=(s,e)=>f.createElement(ee,D({},s,{ref:e,icon:Fe})),Ne=f.forwardRef(qe),y=le;class Re{constructor(){T(this)}dispose(){console.log("dispose")}init(){console.log("init")}}var $e=Object.defineProperty,Ve=(s,e,t)=>e in s?$e(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,b=(s,e,t)=>Ve(s,typeof e!="symbol"?e+"":e,t);class De{constructor(e){this.appConfig=e,b(this,"mutation"),b(this,"currentPassword",new d("",{validators:[x(()=>this.t.forms("required")),q(),_(6,()=>this.t.forms("minLength",{count:6}))]})),b(this,"newPassword",new d("",{validators:[x(()=>this.t.forms("required")),q(),_(6,()=>this.t.forms("minLength",{count:6}))]})),b(this,"repassword",new d("",{validators:[x(()=>this.t.forms("required")),q(),_(6,()=>this.t.forms("minLength",{count:6})),t=>this.newPassword.value!==t.value?[{message:this.t.forms("passwordsDoNotMatch"),type:de.Error}]:[]]})),b(this,"group",new A({currentPassword:this.currentPassword,newPassword:this.newPassword,repassword:this.repassword})),T(this,{handleSubmit:$.bound}),this.mutation=new S(this.appConfig.queryClient,{mutationFn:t=>Y.postAuthChangePassword({changePasswordDto:t}),onError:t=>{this.appConfig.notify.toastError(t)},onSuccess:t=>{this.appConfig.notify.toastSuccess({message:this.t.messages("success")}),this.appConfig.auth.account.updateFromJson(t),this.group.reset()}})}get t(){return this.appConfig.locale.translations}handleSubmit(){if(this.group.isInvalid){this.group.setTouched(!0),this.group.setDirty(!0),this.group.firstErrorControl?.element?.focus();return}const{repassword:e,...t}=this.group.value;this.mutation.mutate(t)}}const ze=P(function(){const{t:e}=he("profile"),t=L(),r=F(()=>new De(t),[t]);return a.jsxs(U,{title:e("password.title"),children:[a.jsxs(z,{children:[a.jsxs(y,{span:24,md:8,children:[a.jsx("h5",{className:"mb-25 font-semibold",children:e("password.requirementsTitle")}),a.jsx("p",{className:"para",children:e("password.requirementsGuide")}),a.jsx("ul",{className:"pl-25 text-muted",children:e("password.requirementsList",{returnObjects:!0,defaultValue:[]}).map((n,o)=>a.jsx("li",{children:n},o))})]}),a.jsx(y,{span:24,md:16,flex:"auto",children:a.jsxs(i,{layout:"vertical",onFinish:r.handleSubmit,children:[a.jsx(i.Item,{name:"currentPassword",label:e("password.old"),...r.currentPassword.itemProps,children:a.jsx(c.Password,{prefix:a.jsx(R,{}),placeholder:"********",...r.currentPassword.inputProps})}),a.jsx(i.Item,{name:"newPassword",label:e("password.new"),...r.newPassword.itemProps,children:a.jsx(c.Password,{prefix:a.jsx(R,{}),placeholder:"********",...r.newPassword.inputProps})}),a.jsx(i.Item,{name:"confirmPassword",label:e("password.confirm"),...r.repassword.itemProps,children:a.jsx(c.Password,{prefix:a.jsx(R,{}),placeholder:"********",...r.repassword.inputProps})})]})})]}),a.jsxs(I,{gap:"small",children:[a.jsx(u,{type:"primary",loading:r.mutation.isPending,htmlType:"submit",disabled:!r.group.isChanged,children:e("password.save")}),a.jsx(u,{type:"default",onClick:r.group.reset,disabled:!r.group.isChanged||r.mutation.isPending,children:e("buttons.reset",{ns:"common"})})]})]})});var re={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},W=g.createContext&&g.createContext(re),Ae=["attr","size","title"];function Ue(s,e){if(s==null)return{};var t=Be(s,e),r,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);for(n=0;n<o.length;n++)r=o[n],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function Be(s,e){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(e.indexOf(r)>=0)continue;t[r]=s[r]}return t}function M(){return M=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},M.apply(this,arguments)}function Z(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function E(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Z(Object(t),!0).forEach(function(r){Qe(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function Qe(s,e,t){return e=Ge(e),e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Ge(s){var e=He(s,"string");return typeof e=="symbol"?e:e+""}function He(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function se(s){return s&&s.map((e,t)=>g.createElement(e.tag,E({key:t},e.attr),se(e.child)))}function Je(s){return e=>g.createElement(We,M({attr:E({},s.attr)},e),se(s.child))}function We(s){var e=t=>{var{attr:r,size:n,title:o}=s,v=Ue(s,Ae),w=n||t.size||"1em",m;return t.className&&(m=t.className),s.className&&(m=(m?m+" ":"")+s.className),g.createElement("svg",M({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,v,{className:m,style:E(E({color:s.color||t.color},t.style),s.style),height:w,width:w,xmlns:"http://www.w3.org/2000/svg"}),o&&g.createElement("title",null,o),s.children)};return W!==void 0?g.createElement(W.Consumer,null,t=>e(t)):e(re)}function Ze(s){return Je({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228.88,26.19a9,9,0,0,0-9.16-1.57L17.06,103.93a14.22,14.22,0,0,0,2.43,27.21L72,141.45V200a15.92,15.92,0,0,0,10,14.83,15.91,15.91,0,0,0,17.51-3.73l25.32-26.26L165,220a15.88,15.88,0,0,0,10.51,4,16.3,16.3,0,0,0,5-.79,15.85,15.85,0,0,0,10.67-11.63L231.77,35A9,9,0,0,0,228.88,26.19Zm-61.14,36L78.15,126.35l-49.6-9.73ZM88,200V152.52l24.79,21.74Zm87.53,8L92.85,135.5l119-85.29Z"},child:[]}]})(s)}var Ke=Object.defineProperty,ke=(s,e,t)=>e in s?Ke(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,p=(s,e,t)=>ke(s,typeof e!="symbol"?e+"":e,t);class Xe{constructor(e){this.appContext=e,p(this,"mutation"),p(this,"requiredValidator",x(()=>this.t.forms("required"))),p(this,"avatar",new ce(null)),p(this,"email",new d(()=>this.profile.email,{validators:[this.requiredValidator,me(()=>this.t.forms("invalidEmail"))]})),p(this,"telegram",new d(()=>this.profile.telegram,{validators:[_(6,()=>this.t.forms("invalidTelegram"))],onChangeValue:t=>{t.startsWith("@")||this.telegram.setValue(`@${t}`)}})),p(this,"name",new d(()=>this.profile.name,{validators:[x(()=>this.t.forms("required"))]})),p(this,"group",new A({email:this.email,telegram:this.telegram,name:this.name})),this.mutation=new S(this.appContext.queryClient,{mutationFn:t=>Y.patchProfile(t),onError:t=>{e.notify.toastError(t)},onSuccess:t=>{this.appContext.notify.toastSuccess({message:this.t.messages("success")}),this.appContext.auth.account.updateFromJson(t),this.group.reset()}}),T(this,{handleSubmit:$.bound,handleReset:$.bound},{autoBind:!0})}get t(){return this.appContext.locale.translations}get profile(){return this.appContext.auth.account}handleReset(){this.group.reset()}handleSubmit(){if(this.group.isInvalid){this.group.setTouched(!0),this.group.setDirty(!0),this.group.firstErrorControl?.element?.focus();return}const{...e}=this.group.value;this.mutation.mutate(e)}}const Ye="_wrapper_uquov_1",et="_upload_uquov_1",K={wrapper:Ye,upload:et},tt=s=>new Promise((e,t)=>{const r=new FileReader;r.readAsDataURL(s),r.onload=()=>e(r.result),r.onerror=n=>t(n)}),rt=P(function({model:e}){const t=L(),r=e.profile,[n,o]=f.useState(!1),[v,w]=f.useState(r.avatarUrl);f.useEffect(()=>oe(()=>r.avatarUrl,l=>{e.avatar.isChanged||w(l)}),[e,r]);const m=l=>{console.log("info",l),e.avatar.setValue(l.file.originFileObj||null)},ae=async l=>{o(!0);const B=l.type==="image/jpeg"||l.type==="image/png";B||t.notify.message.error("You can only upload JPG/PNG file!");const Q=l.size/1024/1024<2;if(Q||t.notify.message.error("Image must smaller than 2MB!"),B&&Q){const ne=await tt(l);return o(!1),w(ne),!1}return!1};return a.jsx(i.Item,{className:K.wrapper,children:a.jsx(fe,{name:"avatar",listType:"picture-card",showUploadList:!1,beforeUpload:ae,onChange:m,fileList:[],className:K.upload,children:v?a.jsx("img",{src:v,alt:"avatar",style:{width:"100%"}}):a.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[n?a.jsx(ge,{}):a.jsx(xe,{}),a.jsx("div",{style:{marginTop:8},children:"Upload"})]})})})}),st=P(function(){const{t:e}=te("profile"),t=L(),r=F(()=>new Xe(t),[t]);return a.jsxs(U,{title:e("edit.title"),children:[a.jsxs(z,{children:[a.jsx(y,{span:24,md:8,children:a.jsx(rt,{model:r})}),a.jsx(y,{span:24,md:16,flex:"auto",children:a.jsxs(i,{layout:"vertical",onFinish:r.handleSubmit,children:[a.jsx(i.Item,{label:e("edit.name"),...r.name.itemProps,children:a.jsx(c,{prefix:a.jsx(we,{}),...r.name.inputProps})}),a.jsx(i.Item,{label:e("edit.email"),...r.email.itemProps,children:a.jsx(c,{prefix:a.jsx(Ne,{}),...r.email.inputProps})}),a.jsx(i.Item,{label:e("edit.telegram"),...r.telegram.itemProps,children:a.jsx(c,{prefix:a.jsx(Ze,{}),...r.telegram.inputProps})})]})})]}),a.jsxs(I,{gap:"small",children:[a.jsx(u,{type:"primary",loading:r.mutation.isPending,htmlType:"submit",disabled:!r.group.isChanged,children:e("edit.save")}),a.jsx(u,{type:"default",onClick:r.handleReset,disabled:!r.group.isChanged||r.mutation.isPending,children:e("buttons.reset",{ns:"common"})})]})]})});var at=Object.defineProperty,nt=(s,e,t)=>e in s?at(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,h=(s,e,t)=>nt(s,typeof e!="symbol"?e+"":e,t);class ot{constructor(e){this.appConfig=e,h(this,"addMutation"),h(this,"deleteMutation"),h(this,"paymentSystemsQuery"),h(this,"name",new d("",{validators:[x(()=>this.t.forms("required"))]})),h(this,"address",new d("",{validators:[x(()=>this.t.forms("required")),pe(/^(?:T[1-9A-HJ-NP-Za-km-z]{33}|0x[a-fA-F0-9]{40}|41[a-fA-F0-9]{40})$/,()=>this.t.forms("invalid"))]})),h(this,"group",new A({name:this.name,address:this.address})),h(this,"modalToggler",new Pe(!1,t=>{t&&(this.group.reset(),this.addMutation.reset())})),T(this,{},{autoBind:!0}),this.paymentSystemsQuery=new ie(e.queryClient,{queryKey:["paymentSystems"],queryFn:async()=>(await new Promise(t=>setTimeout(t,1e3)),[{id:G(),name:"USDT TRC20",address:"TAJBeXjwTQPnC3LTNgAQnBeUQ1qm65Dk1z",createdAt:new Date(Date.now()-2131324).toISOString()}]),transform:(t=[])=>t.map(r=>{const n=new be(r.id);return n.updateFromJson(r),n}),initialDataUpdatedAt:0,staleTime:0}),this.addMutation=new S(this.appConfig.queryClient,{mutationFn:async()=>{await new Promise(t=>setTimeout(t,1e3))},onError:t=>{this.appConfig.notify.toastError(t)},onSuccess:()=>{this.appConfig.notify.toastSuccess({message:this.t.messages("success")}),this.addMutation.reset(),this.modalToggler.disable(),this.paymentSystemsQuery.setQueryData((t=[])=>t.concat({id:G(),address:this.address.value,name:this.name.value,createdAt:new Date().toISOString()}))}}),this.deleteMutation=new S(this.appConfig.queryClient,{mutationFn:async t=>(await new Promise(r=>setTimeout(r,1e3)),t),onError:t=>{this.appConfig.notify.toastError(t)},onSuccess:t=>{this.appConfig.notify.toastSuccess({message:this.t.messages("success")}),this.deleteMutation.reset(),this.paymentSystemsQuery.setQueryData((r=[])=>r.filter(n=>n.id!==t))}})}get t(){return this.appConfig.locale.translations}refresh(){this.paymentSystemsQuery.refetch()}handleAfterOpenChange(e){e||this.group.reset()}handleSubmit(){if(this.group.isInvalid){this.group.setTouched(!0),this.group.setDirty(!0),this.group.firstErrorControl?.element?.focus();return}this.addMutation.mutate()}}const it="_container_1xzq3_1",lt="_center_1xzq3_8",ut="_icon_1xzq3_17",dt="_body_1xzq3_21",j={container:it,center:lt,icon:ut,body:dt},ct={body:j.body},mt=P(function(){const{t:e}=te("profile"),t=L(),r=F(()=>new ot(t),[t]),n=r.paymentSystemsQuery;return a.jsxs(U,{className:j.container,classNames:ct,title:e("payments.title"),extra:a.jsxs(I,{gap:"small",children:[a.jsx(u,{onClick:r.refresh,loading:n.isFetching,icon:a.jsx(_e,{})}),a.jsx(u,{onClick:r.modalToggler.enable,children:e("payments.add")})]}),children:[!n.isFetched&&a.jsx(je,{}),n.isFetched&&n.data.length===0&&a.jsxs("div",{className:j.center,children:[a.jsx(ye,{className:j.icon}),a.jsx("h5",{className:j.text,children:e("payments.empty")})]}),n.isFetched&&n.data.length!==0&&a.jsx(N,{itemLayout:"horizontal",dataSource:n.data,renderItem:o=>a.jsx(N.Item,{actions:[a.jsx(ve,{title:"Удалить платежную систему?",placement:"left",okText:e("buttons.delete",{ns:"common"}),onConfirm:()=>r.deleteMutation.mutate(o.id),children:a.jsx(u,{loading:r.deleteMutation.isPending,icon:a.jsx(Ce,{})})})],children:a.jsx(N.Item.Meta,{title:o.name,description:o.address})},o.id)}),a.jsx(Oe,{title:e("payments.modalTitle"),destroyOnHidden:!0,open:r.modalToggler.isEnabled,onCancel:r.modalToggler.disable,maskClosable:!1,afterOpenChange:r.handleAfterOpenChange,footer:a.jsxs(I,{gap:"small",justify:"flex-end",children:[a.jsx(u,{onClick:r.modalToggler.disable,children:e("buttons.cancel",{ns:"common"})}),a.jsx(u,{type:"primary",loading:r.addMutation.isPending,onClick:r.handleSubmit,disabled:!r.group.isChanged,children:e("buttons.submit",{ns:"common"})})]}),centered:!0,children:a.jsxs(i,{layout:"vertical",onFinish:r.handleSubmit,children:[a.jsx(i.Item,{label:e("payments.name"),...r.name.itemProps,children:a.jsx(c,{placeholder:e("payments.namePlaceholder"),...r.name.inputProps})}),a.jsx(i.Item,{label:e("payments.address"),...r.address.itemProps,children:a.jsx(c,{placeholder:e("payments.addressPlaceholder"),...r.address.inputProps})})]})})]})}),pt="_group_au2bf_5",k={group:pt},ht=P(function(){const e=F(()=>new Re,[]);return console.log("ProfilePage model:",e),a.jsx(ue,{children:a.jsxs(z,{children:[a.jsxs(y,{span:24,xxl:12,className:k.group,children:[a.jsx(st,{}),a.jsx(ze,{})]}),a.jsx(y,{span:24,xxl:12,className:k.group,children:a.jsx(mt,{})})]})})}),At=ht;export{At as component};
